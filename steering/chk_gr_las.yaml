# file : chk.yaml 
# date : 2024.4.13 by R.TSUJI
# lastest update : 2024.04.13 by R.TSUJI

Anchor:
  - &input data/run@NUM@.bld
  - &histout output/chk/run@NUM@.hist.root
  - &output output/chk/run@NUM@.root 
  - &dt2dl ppt
  - &spectrometer ppt
  - &gate_gr gate/gr/gate_gr_ppt_check.yaml
  - &gate_las gate/las/gate_las_ppt_check.yaml

#  - &spectrometer ppt_Li_kf0
#  - &gate_gr gate/gr/gate_gr_ppt_Li_kf0.yaml
#  - &gate_las gate/las/gate_las_ppt_Li_kf0.yaml  

Processor:
  - name: timer
    type: art::TTimerProcessor

  - name: es_rcnp
    type: art::TRCNPEventStore_ts
    parameter:
      OutputTransparency: 1
      InputFiles:
         - *input

  - name: mapper
    type: art::TMappingProcessor
    parameter:
      OutputTransparency: 1
      MapConfig: mapper_tamidaq.conf

  - include: tref.yaml

  - include: trig.yaml
  - include: rf.yaml
  - include: tref_chk.yaml


  - include: pla/pla_gr.yaml
  - include:
      name: vdc/vdc_gr_rawtrack.yaml
      replace:
        DT2DL: *dt2dl
  - include:  vdc/vdc_gr_calib.yaml
  - include:  optics/optics_gr.yaml
  
  - include: pla/pla_las.yaml
  - include:
      name: vdc/vdc_las_rawtrack.yaml
      replace:
        DT2DL: *dt2dl
  - include: vdc/vdc_las_calib.yaml  		
  - include:  optics/optics_las.yaml



  - include:
      name: pid/pid_calib.yaml
      replace:
        SETUP: ppt
  - include:  pid/tof.yaml

  - include:
      name: energy_calib/energy_calib.yaml
      replace:
        SETUP: *spectrometer
  - include: *gate_gr
  - include: *gate_las


  - name: hist_pla_gr_track
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/pla/pla_gr.hist.yaml	
      OutputFilename: *histout

  - name: hist_pla_las_track
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/pla/pla_las.hist.yaml	
      OutputFilename: *histout

  - name: hist_vdc_gr_plane
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/vdc/vdc_gr_plane.hist.yaml
      OutputFilename: *histout

  - name: hist_vdc_las_plane
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/vdc/vdc_las_plane.hist.yaml
      OutputFilename: *histout


  - name: hist_vdc_gr_track
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/vdc/vdc_gr.hist.yaml
      OutputFilename: *histout

  - name: hist_vdc_las_track
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/vdc/vdc_las.hist.yaml
      OutputFilename: *histout

  - name: hist_pid_gr
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/pid/pid_gr.hist.yaml
      OutputFilename: *histout

  - name: hist_pid_las
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/pid/pid_las.hist.yaml
      OutputFilename: *histout

  - name: hist_pid_gr_calib
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/pid/pid_gr_calib.hist.yaml
      OutputFilename: *histout

  - name: hist_pid_las_calib
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/pid/pid_las_calib.hist.yaml
      OutputFilename: *histout

  - name: hist_optics
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/optics/optics_corr.hist.yaml
      OutputFilename: *histout
            
  - name: hist_eff_mhit_gr
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/eff/mhit_gr_eff.hist.yaml
      OutputFilename: *histout
  - name: hist_mhit_las
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/eff/mhit_las_eff.hist.yaml
      OutputFilename: *histout
      
  - name: hist_vdceff_gr
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/eff/vdc_gr_eff.hist.yaml
      OutputFilename: *histout
  - name: hist_vdceff_las
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/eff/vdc_las_eff.hist.yaml
      OutputFilename: *histout

  - name: hist_vdc_gr_las
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/vdc/vdc_gr_las.hist.yaml
      OutputFilename: *histout

  - name: hist_phys
    type: art::TTreeProjectionProcessor
    parameter:
      Type: art::TTreeProjection
      FileName: hist/phys/phys.hist.yaml
      OutputFilename: *histout

  - name: outputtree
    type: art::TOutputTreeProcessor
    parameter:
      FileName: *output